(()=>{"use strict";const t=["./assets/bg1.jpg","./assets/plane_0.png","./assets/fire.png"],e={imgList:[],loadAssets(){return new Promise(((e,s)=>{let i=0;for(let h=0;h<t.length;h++){let a=new Image;a.src=t[h],this.imgList.push(a),a.onload=s=>{i++,i==t.length&&(console.log("资源加载完毕"),e())},a.onerror=t=>{s()}}}))}},s=class{constructor(t,e,s){this.x=t,this.y=e,this.img=s,this.width=this.img.width,this.height=this.img.height}draw(t){t.drawImage(this.img,this.width,this.height,this.x,this.y)}},i=class extends s{constructor(){let t=e.imgList[0];super(0,-t.height/2,t),this.speed=1}draw(t){this.move(),super.draw(t)}move(){this.y+=this.speed,this.y>0&&(this.y=-this.height/2)}},h={bg:null,p1:null};class a extends s{constructor(t,s){let i=e.imgList[2];super(t,s,i),this.width=i.width/2,this.height=i.height/2,this.speed=20}move(){if(this.y-=this.speed,this.y<0){let t=h.bulletList.indexOf(this);-1!=t&&h.bulletList.splice(t,1)}}draw(){this.move(),super.draw(ctx)}}const n=class extends s{constructor(){super(200,500,e.imgList[1])}move(t,e){this.x=t,this.y=e}fire(){let t=new a(this.x,this.y);t.x=t.x+this.width/2-t.width/2,h.bulletList.push(t)}},r={gameWidth:512,gameHeight:768,maxEnemyCount:5,_level:1,get level(){return this._level},set level(t){switch(this._level=t,t){case 1:default:this.maxEnemyCount=5;break;case 2:this.maxEnemyCount=10;break;case 3:this.maxEnemyCount=15}}};class l extends s{constructor(){let t=null;t=parseInt(100*Math.random())<15?e.imgList[3]:e.imgList[4],super(parseInt(Math.random()*r.gameWidth),0,t),this.speed=parseInt(3*Math.random())+1}move(){if(this.y+=this.speed,this.y>r.gameHeight){let t=h.enemyList.indexOf(this);-1!=t&&h.enemyList.splice(t,1)}}}({dom:{game:document.querySelector("#game")},data:{gameWidth:512,gameHeight:768,ctx:null,p1FireTimeID:null},draw(){setInterval((()=>{Reflect.ownKeys(h).forEach((t=>{h[t]&&h[t]instanceof s&&h[t].draw(this.data.ctx)}))}),20)},bindEvent(){this.dom.game.addEventListener("mousemove",(t=>{t=t||window.event;let{offsetX:e,offsetY:s}=t;h.hero.move(e,s)})),this.dom.game.addEventListener("mousedown",(t=>0==t.button&&this.p1Fire())),this.dom.game.addEventListener("mouseup",(t=>{this.p1StopFire()}))},async init(){this.dom.game.width=r.gameWidth,this.dom.game.height=r.gameHeight,this.data.ctx=this.dom.game.getContext("2d"),await e.loadAssets(),h.bg=new i,h.p1=new n,this.bindEvent(),this.addEnemy(),this.draw()},draw(){setInterval((()=>{Reflect.ownKeys(h).forEach((t=>{h[t]&&h[t]instanceof s?h[t].draw(this.data.ctx):h[t]instanceof Array&&h[t].forEach((t=>{t.draw(this.data.ctx)}))}))}),20)},addEnemy(){setInterval((()=>{let{maxEnemyCount:t}=r,e=t-h.enemyList.length;for(let t=0;t<e;t++){let t=new l;h.enemyList.push(t)}}),200)},p1Fire(){this.data.p1FireTimeID=setInterval((()=>{h.p1&&h.p1.fire()}),100)},p1StopFire(){clearInterval(this.data.p1FireTimeID)},checkCrash:(t,e)=>!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y),checkBulletAndCrash(){for(let t=h.bulletList.length-1;t>=0;t--)for(let e=h.enemyList.length-1;e>=0;e--){let s=h.bulletList[t],i=h.enemyList[e];if(this.checkCrash(s,i)){h.bulletList.splice(t,1),h.enemyList.splice(e,1);break}}}}).init()})();